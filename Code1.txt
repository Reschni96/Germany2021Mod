campaignTrail_temp.election_json = JSON.parse("[{\"model\": \"campaign_trail.election\", \"pk\": 9, \"fields\": {\"year\": 2021, \"summary\": \"<p>After serving as chancellor of Germany for 16 years, Angela Merkel is preparing to step down. Consequently, the federal election in 2021 will mark a significant milestone in the history of the Federal Republic of Germany, as no incumbent chancellor will be defending their position. Three parties are currently engaged in serious competition for the opportunity to lead Germany into a new era.</p><p>Prominent issues in this election include the Covid pandemic and its response, climate change and the transition to renewable energies. Additionally, foreign policy, tax policy, digitalization, and social security are also key concerns for many voters.</p>\", \"image_url\": \"https://upload.wikimedia.org/wikipedia/en/thumb/b/ba/Flag_of_Germany.svg/1200px-Flag_of_Germany.svg.png\", \"winning_electoral_vote_number\": 368, \"advisor_url\": \"https://i.ibb.co/PQrG6fR/advisors.jpg\", \"recommended_reading\": \"\", \"has_visits\": 0, \"no_electoral_majority_image\": \"/static/images/2012-no-majority.jpg\"}}]");
campaignTrail_temp.candidate_json = JSON.parse("[{\"model\": \"campaign_trail.candidate\", \"pk\": 77, \"fields\": {\"first_name\": \"\", \"last_name\": \"CDU／CSU\", \"election\": 9, \"party\": \"Christian Democratic Union/Christian Social Union\", \"state\": \"-\", \"priority\": 1, \"description\": \"<ul class='my-ul'><li>Abbreviation: CDU/CSU</li><li>Name: Christian Democratic Union/Christian Social Union</li></ul><p>The CSU (in Bavaria) and CDU (in the rest of Germany) are the dominant center-right parties in Germany. They were founded in the aftermath of the Second World War and have dominated German politics ever since - more often than not, the chancellor has been a member of the CDU.</p><p>In the lead-up to the 2021 election, the alliance of those two parties finds itself in an uncertain state, though. For more than sixteen years, Angela Merkel has been the face of the CDU. However, her handpicked successor Annegret Kramp-Karrenbauer resigned as party leader less than a year before the election, making it unclear who will be the chancellor candidate.</p><p>The party has several competing wings - a moderate wing that wants to broadly continue Merkel’s policy and a conservative wing that wants to return closer to the roots of the party. Meanwhile, the CSU might want to place their leader as chancellor candidate for the two parties. Whoever ends up being the chancellor candidate is starting this election campaign in the lead.</p>\", \"color_hex\": \"#28282B\", \"secondary_color_hex\": \"#77797D\", \"is_active\": 1, \"image_url\": \"https://i.imgur.com/XGtdJT9.jpg\", \"electoral_victory_message\": \" \", \"electoral_loss_message\": \" \", \"no_electoral_majority_message\": \"\", \"description_as_running_mate\": \"\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 78, \"fields\": {\"first_name\": \"\", \"last_name\": \"SPD\", \"election\": 9, \"party\": \"Social Democratic Party\", \"state\": \"-\", \"priority\": 2, \"description\": \"<p><ul class='my-ul'><li>Abbreviation: SPD</li><li>Name: Social Democratic Party</li></ul><p>The Social Democratic Party of Germany (SPD) is one of the major political parties in Germany and has played a significant role in the country's political landscape since its establishment in 1875. Since the Second World War, it has led the government several times.</p><p>In 2021, the party is in a bad state though. For the last eight years, it had the thankless job of being the junior coalition partner of the CDU/CSU. A lot of party members want a more left-wing vision for the party opposed to the more centrist approach in the last years. These feelings culminated in the election of Norbert Walter-Borjans and Saskia Esken, two relatively unknown but left politicians as party leaders in 2019.</p><p>However, none of those two want to become chancellor candidate. With how much the party is struggling in the polls - registering below 15% at times - it’s unclear how much sense it makes to nominate a chancellor candidate at all.</p>\", \"color_hex\": \"#D61A29\", \"secondary_color_hex\": \"#F5878F\", \"is_active\": 1, \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2d/Sozialdemokratische_Partei_Deutschlands%2C_Logo_um_2000.svg/2048px-Sozialdemokratische_Partei_Deutschlands%2C_Logo_um_2000.svg.png\", \"electoral_victory_message\": \"\", \"electoral_loss_message\": \"\", \"no_electoral_majority_message\": \"\", \"description_as_running_mate\": \"\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 79, \"fields\": {\"first_name\": \"\", \"last_name\": \"Green Party\", \"election\": 9, \"party\": \"Alliance 90/The Greens\", \"state\": \"-\", \"priority\": 3, \"description\": \"<p><ul class='my-ul'><li>Abbreviation: Green Party</li><li>Name: Alliance 90/The Greens</li></p></ul><p>The Green Party is a relatively young party, having been founded in 1980 as a consequence of the environmental movement in the 1970s. In 1993, it merged with Alliance 90, an East German civil rights party. Since then, it has transformed from a party focused only on environmental policies and pacifism to a general center-left party, though there's still a strong focus on climate change and the environment.</p><p>In the last few years, the Green Party has become stronger and stronger. They are members of the majority of state governments and even lead one such government. With climate change being one of the most important topics this election season, they prepare to nominate a chancellor candidate and hope to capture the chancellorship for the first time in their history.</p><p>However, the Green Party is known for having strong showings in the polls and being unable to actually convert that to votes come election day. For now, they look like the main contender of the CDU/CSU, but a lot can still change.</p>\", \"color_hex\": \"#13A12D\", \"secondary_color_hex\": \"#8FDB8F\", \"is_active\": 1, \"image_url\": \"https://i.ibb.co/tQmtGBz/Greens.png\", \"electoral_victory_message\": \"\", \"electoral_loss_message\": \"\", \"no_electoral_majority_message\": \"\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 303, \"fields\": {\"first_name\": \"\", \"last_name\": \"FDP\", \"election\": 9, \"party\": \"Free Democratic Party\", \"state\": \"-\", \"priority\": 4, \"description\": \"'\", \"color_hex\": \"#F5F518\", \"secondary_color_hex\": \"#FAFA9B\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}},{\"model\": \"campaign_trail.candidate\", \"pk\": 304, \"fields\": {\"first_name\": \"\", \"last_name\": \"The Left\", \"election\": 9, \"party\": \"The Left\", \"state\": \"-\", \"priority\": 5, \"description\": \"'\", \"color_hex\": \"#C910BA\", \"secondary_color_hex\": \"#F595ED\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}},{\"model\": \"campaign_trail.candidate\", \"pk\": 305, \"fields\": {\"first_name\": \"\", \"last_name\": \"AfD\", \"election\": 9, \"party\": \"Alternative for Germany\", \"-\": \"New York\", \"priority\": 6, \"description\": \"'\", \"color_hex\": \"#2B8FE0\", \"secondary_color_hex\": \"#85BEED\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}},{\"model\": \"campaign_trail.candidate\", \"pk\": 306, \"fields\": {\"first_name\": \"\", \"last_name\": \"Others\", \"election\": 9, \"party\": \"Minor Parties\", \"state\": \"-\", \"priority\": 7, \"description\": \"'\", \"color_hex\": \"#807E7F\", \"secondary_color_hex\": \"#C9C7C9\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}},{\"model\": \"campaign_trail.candidate\", \"pk\": 307, \"fields\": {\"first_name\": \"Armin\", \"last_name\": \"Laschet\", \"election\": 9, \"party\": \"CDU\", \"state\": \"North Rhine-Westphalia\", \"priority\": 8, \"description\": \"'\", \"color_hex\": \"#0000FF\", \"secondary_color_hex\": \"#90C0FF\", \"is_active\": 0, \"image_url\": \"https://i.ibb.co/z4HQGwg/laschet2.jpg\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Armin Lascher is certainly a candidate</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 308, \"fields\": {\"first_name\": \"Friedrich\", \"last_name\": \"Merz\", \"election\": 9, \"party\": \"CDU\", \"state\": \"North Rhine-Westphalia\", \"priority\": 9, \"description\": \"'\", \"color_hex\": \"#0000FF\", \"secondary_color_hex\": \"#90C0FF\", \"is_active\": 0, \"image_url\": \"https://i.ibb.co/P4hnWXb/Merz.jpg\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Merz is also certainly a candidate.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 309, \"fields\": {\"first_name\": \"Markus\", \"last_name\": \"Söder\", \"election\": 9, \"party\": \"CSU\", \"state\": \"Bavaria\", \"priority\": 10, \"description\": \"'\", \"color_hex\": \"#FF0000\", \"secondary_color_hex\": \"#FFA0A0\", \"is_active\": 0, \"image_url\": \"https://i.ibb.co/NZ4NSY9/Markus-S-der.jpg\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Söder is a candidate, but Bavarian.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 310, \"fields\": {\"first_name\": \"Olaf\", \"last_name\": \"Scholz\", \"election\": 9, \"party\": \"SPD\", \"state\": \"Hamburg\", \"priority\": 11, \"description\": \"'\", \"color_hex\": \"#FF0000\", \"secondary_color_hex\": \"#FFA0A0\", \"is_active\": 0, \"image_url\": \"https://i.ibb.co/z735fdt/Scholz.jpg\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>The one and only Scholzomat.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 313, \"fields\": {\"first_name\": \"Rolf\", \"last_name\": \"Mützenich\", \"election\": 9, \"party\": \"SPD\", \"state\": \"North Rhine-Westphalia\", \"priority\": 11, \"description\": \"'\", \"color_hex\": \"#FF0000\", \"secondary_color_hex\": \"#FFA0A0\", \"is_active\": 0, \"image_url\": \"https://i.ibb.co/z735fdt/Scholz.jpg\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Rolf who?</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 311, \"fields\": {\"first_name\": \"Annalena\", \"last_name\": \"Baerbock\", \"election\": 9, \"party\": \"Greens\", \"state\": \"Brandenburg\", \"priority\": 12, \"description\": \"'\", \"color_hex\": \"#FFFF00\", \"secondary_color_hex\": \"#FFFFC0\", \"is_active\": 0, \"image_url\": \"https://i.ibb.co/MP0P2yQ/Baerbock.jpg\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"A Green Party Candidate\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 312, \"fields\": {\"first_name\": \"Robert\", \"last_name\": \"Habeck\", \"election\": 9, \"party\": \"Greens\", \"state\": \"Schleswig-Holstein\", \"priority\": 13, \"description\": \"'\", \"color_hex\": \"#00C100\", \"secondary_color_hex\": \"#A1FFA1\", \"is_active\": 0, \"image_url\": \"https://i.ibb.co/VBZWCSM/habeck.jpg\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"Another Green Candidate\", \"candidate_score\": 0.0}}]");
campaignTrail_temp.running_mate_json = JSON.parse("[{\"model\": \"campaign_trail.running_mate\", \"pk\": 47, \"fields\": {\"candidate\": 77, \"running_mate\": 307}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 56, \"fields\": {\"candidate\": 77, \"running_mate\": 308}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 76, \"fields\": {\"candidate\": 77, \"running_mate\": 309}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 78, \"running_mate\": 310}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 105, \"fields\": {\"candidate\": 79, \"running_mate\": 311}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 81, \"fields\": {\"candidate\": 79, \"running_mate\": 312}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 821111111111, \"fields\": {\"candidate\": 78, \"running_mate\": 313}}]");
campaignTrail_temp.opponents_default_json = JSON.parse("[{\"election\": 9, \"candidates\": [77, 78, 79, 303, 304, 305, 306]}]");
campaignTrail_temp.opponents_weighted_json = JSON.parse("[{\"election\": 9, \"candidates\": [77, 78, 79, 303, 304, 305, 306]}]");
campaignTrail_temp.global_parameter_json = JSON.parse("[{\"model\": \"campaign_trail.global_parameter\", \"pk\": 1, \"fields\": {\"vote_variable\": 1.125, \"max_swing\": 0.12, \"start_point\": 0.94, \"candidate_issue_weight\": 10.0, \"running_mate_issue_weight\": 0.0, \"issue_stance_1_max\": -0.71, \"issue_stance_2_max\": -0.3, \"issue_stance_3_max\": -0.125, \"issue_stance_4_max\": 0.125, \"issue_stance_5_max\": 0.3, \"issue_stance_6_max\": 0.71, \"global_variance\": 0.01, \"state_variance\": 0.005, \"question_count\": 33, \"default_map_color_hex\": \"#C9C9C9\", \"no_state_map_color_hex\": \"#999999\"}}]");
campaignTrail_temp.candidate_dropout_json = JSON.parse("[{\"model\": \"campaign_trail.candidate_dropout\", \"pk\": 1, \"fields\": {\"candidate\": 36, \"affected_candidate\": 18, \"probability\": 1.0}}]");
campaignTrail_temp.temp_election_list = [{"id": 9, "year": 2021, "is_premium": 0, "display_year": "2021DE"}];
campaignTrail_temp.show_premium = true;
campaignTrail_temp.premier_ab_test_version = -1;
campaignTrail_temp.credits = 'u/Vilvilea';
campaignTrail_temp.coalitionDifficulty = 1;
e=campaignTrail_temp;
HistName=["Replace Me"];
e.collect_results = true;
$("#game_window")[0].style.backgroundImage = "url(https://i.imgur.com/9nFY6eE.jpg)";
nct_stuff.themes[nct_stuff.selectedTheme].coloring_title = "#070785"
nct_stuff.themes[nct_stuff.selectedTheme].coloring_window = "#031299"
document.getElementsByClassName("game_header")[0].style.backgroundColor = nct_stuff.themes[nct_stuff.selectedTheme].coloring_title
$(".container")[0].style.backgroundColor = "#001f58"
document.body.background = "https://www.morgenpost.de/bin/src-207619493.jpg"
document.body.style.backgroundRepeat = "no-repeat";
document.body.style.backgroundSize = "cover";
document.getElementById("header").src = "https://cdn.discordapp.com/attachments/1109846390575730788/1131322097562558514/Germany3.png";
nct_stuff.themes[nct_stuff.selectedTheme].text_col = "white"
e.music = {};
e.music.shuffleEnabled = false;
e.music.Volume=0.3;
e.displayTooltips = true;

quotes = [`"Wir schaffen das!" - Angela Merkel`, `"Scheitert der Euro, scheitert Europa." - Angela Merkel`, `"Das Internet ist für uns alle Neuland." - Angela Merkel`, `"Die Demokratie ist kein Supermarkt." - Frank-Walther Steinmeier`, `In my homeland Baden-Württemberg we are all sitting in one boat.`, `"Rechts von der CDU/CSU darf es keine demokratisch legitimierte Partei geben" - Franz-Joseph Strauß`, `"Jetzt wächst zusammen, was zusammen gehört" - Willy Brandt`, `Was kümmert mich mein Geschwätz von gestern? - Konrad Adenauer`, `"Wer Visionen hat, sollte zum Arzt gehen" - Helmut Schmidt`, `There will never be a revolution in Germany. The bureaucratic paperwork for it is missing.`, ]
customquote = quotes[Math.floor((Math.random() * quotes.length))]

corrr="\n<h2>NEUE WAHLKAMPF-TOUR</h2><font id='wittyquote' size='4' color='white'><em>" + customquote + "</em></font>"

var element = document.getElementById('my-invisible-element');
if (!element) {

    // Get the reference to the bar
    var bar = document.getElementById('bottomBar');

    // Create the checkbox
    var checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = 'volumeCheckbox';
    checkbox.checked = true;  // Checked by default

    // Create the label for the checkbox
    var label = document.createElement('label');
    label.htmlFor = 'volumeCheckbox';
    label.style.fontSize = '18px';  // Increase the size of the text
    label.style.fontWeight = 'bold';  // Make the text bold
    label.appendChild(document.createTextNode('Enable Volume'));

    // Wrap the checkbox and label in a div and style it
    var wrapper = document.createElement('div');
    wrapper.style.padding = '10px';  // Add some padding
    wrapper.style.borderRadius = '10px';  // Round the corners
    wrapper.style.backgroundColor = '#d3d3d3';  // Set the background color to the default button color
    wrapper.style.border = '1px solid black';  // Add a black border
    wrapper.appendChild(checkbox);
    wrapper.appendChild(label);

    // Position the wrapper in the middle of the bar
    var div = document.createElement('div');
    div.style.position = 'absolute';
    div.style.left = '50%';
    div.style.transform = 'translate(-50%, 0)';  // Center the div
    div.appendChild(wrapper);

    // Add the div to the bar
    bar.appendChild(div);

    // Add event listener to the checkbox
    checkbox.addEventListener('change', function() {
        if (!this.checked) {
            e.music.Volume = 0;  // Set the initial volume of the music player to 0
        }
    });


    let trackIndices;
    let shuffledIndices;

 $("#game_start").click((event) => {
    event.preventDefault();
    musicMode()
      })
    musicMode = () => {
        $("#music_player")[0].children[0].style.display = "none"
        $("#music_player")[0].children[1].style.display = "none"
        document.getElementById("modLoadReveal").style.display = "none"
        document.getElementById("modloaddiv").style.display = "none"
        musicBox = document.getElementById("music_player")
        musicBox.style.display = ""
        var trackSel;
        e = campaignTrail_temp
        e.selectedSoundtrack = 0
        toTime = (seconds) => {
            var date = new Date(null);
            date.setSeconds(seconds);
            return date.toISOString().substr(11, 8);
        }
        generateTime = () => {
            // Get the audio element
            var audio = document.getElementById("campaigntrailmusic");
            timeTracker = document.createElement("div");
            timeTracker.style = `
      text-align:left;
      border-style:solid;
      border-width:3px;
      height:200px;
      width:200px;
      background-color:#6699CC;
      float:right;
      padding: 10px;
      `
            $("#trackSelParent")[0].prepend(timeTracker);
            $("#trackSelParent")[0].prepend(document.createElement("br"));
            var positionDisplay = document.createElement("gg");
            positionDisplay.id = "position-display";
            var timeSlider = document.createElement("input");
            timeSlider.type = "range";
            timeSlider.min = 0;
            timeSlider.max = 1;
            timeSlider.step = 0.001;
            timeSlider.value = 0;
            timeSlider.style.width = "200px";
            timeSlider.id = "time-slider";
            var pausePlay = document.createElement("button");
            pausePlay.id = "position-display";
            pausePlay.innerHTML = "<b>Pause</b>"
            pausePlay.style.width = "100%";
            pausePlay.style.margin = "2px";
            pausePlay.addEventListener("click", event => {
                event.preventDefault();
                updatePositionDisplay();
                let audio = document.getElementById("campaigntrailmusic");
                if (audio.paused) {
                    audio.play();
                    event.target.innerHTML = "<b>Pause</b>";
                    return;
                }
                audio.pause();
                event.target.innerHTML = "<b>Play</b>";
                return;
            })
            var shuffleButton = document.createElement("button");
            shuffleButton.id = "shuffle-button";
            shuffleButton.innerHTML = "<b>Shuffle</b>"
            shuffleButton.style.width = "100%"
            shuffleButton.style.margin = "2px";;
            shuffleButton.addEventListener("click", event => {
                event.preventDefault();
                e.music.shuffleEnabled = !e.music.shuffleEnabled;
                event.target.innerHTML = e.music.shuffleEnabled ? "<b>Unshuffle</b>" : "<b>Shuffle</b>";
                if (e.music.shuffleEnabled) {
                    shuffledIndices = shuffle(trackIndices.slice());
                    let currentTrackIndex = Number(document.querySelector('input[name="trackSelector"]:checked').value);
                    shuffledIndices = shuffledIndices.filter(index => index !== currentTrackIndex);
                    shuffledIndices.unshift(currentTrackIndex);
                }
            });
            var skipButton = document.createElement("button");
            skipButton.id = "skip-button";
            skipButton.innerHTML = "<b>Skip</b>"
            skipButton.style.width = "100%";
            skipButton.style.margin = "2px"; // Add margin
            skipButton.addEventListener("click", event => {
                event.preventDefault();
                let selected = Number(document.querySelector('input[name="trackSelector"]:checked').value);
                let newSel;
                if (e.music.shuffleEnabled) {
                    if (!shuffledIndices) {
                        shuffledIndices = shuffle(trackIndices.slice());
                    }
                    let currentIndex = shuffledIndices.findIndex(index => index === selected);
                    if (currentIndex === shuffledIndices.length - 1) {
                        shuffledIndices = shuffle(trackIndices.slice());
                        currentIndex = -1;
                    }
                    newSel = shuffledIndices[currentIndex + 1];
                } else {
                    newSel = selected + 1 === soundtracks[e.selectedSoundtrack].tracklist.length ? 0 : selected + 1;
                }
                let buttons = Array.from(document.getElementById("trackSel").children).filter(f => {
                        return f.tagName == "LABEL"
                    }).map(f => f.children[0])
                buttons[newSel].click()
            });
            var volumeLabel = document.createElement("gg");
            volumeLabel.id = "volume-label";
            volumeLabel.innerHTML = "<br><b>Volume: </b>"
            var volumeSlider = document.createElement("input");
            volumeSlider.type = "range";
            volumeSlider.min = 0;
            volumeSlider.max = 1;
            volumeSlider.step = 0.001;
            volumeSlider.value = 0;
            volumeSlider.style.width = "200px";
            volumeSlider.id = "volume-slider";
            audio.volume= e.music.Volume;
            volumeSlider.value = audio.volume;
            timeTracker.appendChild(pausePlay);
            timeTracker.appendChild(shuffleButton);
            timeTracker.appendChild(skipButton);
            timeTracker.appendChild(positionDisplay);
            timeTracker.appendChild(timeSlider);
            timeTracker.appendChild(volumeLabel);
            timeTracker.appendChild(volumeSlider);
            updatePositionDisplay();
            function updatePositionDisplay() {
                positionDisplay.innerHTML = "<b>Time:</b> " + toTime(audio.currentTime) + "<br>";
                timeSlider.value = audio.duration ? audio.currentTime / audio.duration : 0;
            }
            function changeTime() {
                positionDisplay.innerHTML = "<b>Time:</b> " + toTime(audio.currentTime) + "<br>";
                audio.currentTime = timeSlider.value * audio.duration;
            }
            updateVolume = event => {
                audio.volume = event.target.value;
                e.music.Volume=audio.volume;
            }
            setInterval(updatePositionDisplay, 1000);
            timeSlider.addEventListener("input", changeTime);
            volumeSlider.addEventListener("input", updateVolume)
        }

        function newMusicPlayer() {
            trackSel = document.createElement("div");
            trackSel.id = "trackSelParent"
            let z = `<br><br><br><br><br><br><br><br><br><br><br><br><div id='trackSel' style="text-align:left;border-style:solid;border-width:3px;overflow-y: scroll;overflow-x: hidden;height:200px; width:400px;background-color:#6699CC;float:right;">`
            z += `<b><select id='selectSoundtrack'><option value='` + soundtracks[e.selectedSoundtrack].name + `'>` + soundtracks[e.selectedSoundtrack].name + "</option>"
            for (i in soundtracks) {
                if (soundtracks[e.selectedSoundtrack] != soundtracks[i]) {
                    z += `<option value='` + soundtracks[i].name + `'>` + soundtracks[i].name + `</option>`
                }
            }
            z += `</select></b><br><br>`
                // <label><input type="radio" name="option" value="option1">Option 1</label><br>
            for (i in soundtracks[e.selectedSoundtrack].tracklist) {
                let a = soundtracks[e.selectedSoundtrack].tracklist[i]
                let b = `<label><input class="trackSelector" type="radio" name="trackSelector" value="` + i + `">` + a.name + `</label><br>`
                z += b
            }
            z += "</div><br><br>"
            trackSel.innerHTML = z
            musicBox.appendChild(trackSel);
            Array.from(document.getElementById("trackSel").children).filter(f => {
                return f.tagName == "LABEL"
            }).map(f => f.children[0])[0].checked = true
            soundtrackSelector = document.getElementById("selectSoundtrack")
            soundtrackSelector.onchange = function() {
                for (i in soundtracks) {
                    if (soundtracks[i].name == soundtrackSelector.value) {
                        e.selectedSoundtrack = i
                        break
                    }
                }
                e.music.shuffleEnabled = false;
                shuffledIndices = null;

                document.getElementById("trackSelParent").remove()
                newMusicPlayer()
            }
            var matches = document.querySelectorAll('.trackSelector');
            for (match in matches) {
                matches[match].onchange = function() {
                    audio = $("#campaigntrailmusic")[0];
                    audio.src = soundtracks[e.selectedSoundtrack].tracklist[this.value].url
                    audio.currentTime = 0
                }
            }
            musicBox.children[2].loop = false
            musicBox.children[2].src = soundtracks[e.selectedSoundtrack].tracklist[0].url
            trackIndices = Array.from({length: soundtracks[e.selectedSoundtrack].tracklist.length}, (_, i) => i);

            musicBox.children[2].onended = function() {
                let selected = Number(document.querySelector('input[name="trackSelector"]:checked').value);
                let newSel;
                if (e.music.shuffleEnabled) {
                    if (!shuffledIndices) {
                        shuffledIndices = shuffle(trackIndices.slice());
                    }
                    let currentIndex = shuffledIndices.findIndex(index => index === selected);
                    if (currentIndex === shuffledIndices.length - 1) {
                        shuffledIndices = shuffle(trackIndices.slice());
                        currentIndex = -1;
                    }
                    newSel = shuffledIndices[currentIndex + 1];
                } else {
                    newSel = selected + 1 === soundtracks[e.selectedSoundtrack].tracklist.length ? 0 : selected + 1;
                }
                let buttons = Array.from(document.getElementById("trackSel").children).filter(f => {
                        return f.tagName == "LABEL"
                    }).map(f => f.children[0])
                buttons[newSel].click()
            }

            for (w = 0; w < 7; w++) {
              document.getElementById("trackSelParent").appendChild(document.createElement("br"))
            }
            generateTime();
        }
        clamp = function(a, max, min, overflow = true) {
            if (overflow) {
                return a > max ? min : a < min ? max : a;
            }
            return a > max ? max : a < min ? min : a;
        }
        var soundtracks = {
            0: {
              name: "German Kulturgut",
              tracklist: [
                {
                  "name": "Tagesthemen Intro die Ärzte",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296705669775400/Tagesthemen_Intro_Die_Arzte.mp3"
                },
                {
                  "name": "Tagesschau Intro",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296698044534914/Tagesschau_Intro.mp3"
                },
                {
                  "name": "Tagesschau Theme",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296495463833741/Hans_Carste__Henning_Lohner_-_ARD_Tagesschau_Theme.mp3"
                },
                {
                  "name": "Tatort Intro",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296542708473906/Klaus_Doldinger_-_Tatort_Intro.mp3"
                },
                {
                  "name": "Lindenstraße Musik",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296532390490172/Jurgen_Knieper_-_Lindenstrae_Titelmelodie.mp3"
                },
                {
                  "name": "Das Lied der Deutschen",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296382335057980/August_Hoffmann_von_Fallersleben_-_Lied_der_Deutschen_German_National_Anthem.mp3"
                },
                {
                  "name": "Europahymne",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296462551134340/Friedrich_Schiller__Ludwig_van_Beethoven_-_An_die_Freude_EU_Anthem.mp3"
                },
                {
                  "name": "Einzug der Götter in Walhall",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296655837249657/Richard_Wagner__hr-Sinfonieorchester_-_Einzug_der_Gotter_in_Walhall_Das_Rheingold.mp3"
                }
            ]
                },
                1: {
              name: "German Oldies",
              tracklist: [
                {
                  "name": "Nena – 99 Luftballons",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296608349327381/NENA_-_99_Luftballons.mp3"
                },
                {
                  "name": "Trio – Da Da Da",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296755221270558/Trio_-_Da_Da_Da.mp3"
                },
                {
                  "name": "Kraftwerk – Autobahn",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296574350303412/Kraftwerk_-_Autobahn.mp3"
                },
                {
                  "name": "Udo Jürgens – Griechischer Wein ",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296762661978183/Udo_Jurgens_-_Griechischer_Wein.mp3"
                },
                {
                  "name": "Udo Lindenberg – Sonderzug nach Pankow ",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296771319017544/Udo_Lindenberg_-_Sonderzug_nach_Pankow.mp3"
                },
                {
                  "name": "Nina Hagen – Du hast den Farbfilm vergessen ",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296635834613781/Nina_Hagen_-_Du_hast_den_Farbfilm_vergessen.mp3"
                },
                {
                  "name": "Nena – Irgendwie, Irgendwo, Irgendwann",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296615899070544/NENA_-_Irgendwie_Irgendwo_Irgendwann.mp3"
                },
                {
                  "name": "Die Ärzte - Schrei nach Liebe",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296418104090744/Die_Arzte_-_Schrei_nach_Liebe.mp3"
                },
                {
                  "name": "Die Ärzte - Deine Schuld",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296396750893077/Die_Arzte_-_Deine_Schuld.mp3"
                }
            ]
                },
                2: {
              name: "Modern German Music",
              tracklist: [
                {
                  "name": "Wir sind Helden – Nur Ein Wort",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296791678160976/Wir_Sind_Helden_-_Nur_Ein_Wort.mp3"
                },
                {
                  "name": "AnnenMayKantereit – Oft gefragt",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296345588772994/AnnenMayKantereit_-_Oft_Gefragt.mp3"
                },
                {
                  "name": "Peter Fox – Schwarz zu Blau",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296645838028820/Peter_Fox_-_Schwarz_zu_Blau.mp3"
                },
                {
                  "name": "KRAFTKLUB – Schüsse in die Luft",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296567064809522/Kraftklub_-_Schusse_in_die_Luft.mp3"
                },
                {
                  "name": "Andreas Bourani – Auf Uns",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296341247672320/Andreas_Bourani_-_Auf_uns.mp3"
                },
                {
                  "name": "Tim Bendzko – Nur Noch Kurz die Welt retten ",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296735856177282/Tim_Bendzko_-_Nur_Noch_Kurz_Die_Welt_Retten.mp3"
                },
                {
                  "name": "Polarkreis 18 – Allein Allein",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131509584436154388/Polarkreis_18_-_Allein_Allein.mp3"
                }
            ]
                },
                3: {
              name: "Deutsche Volkslieder (CDU)",
              tracklist: [
                {
                  "name": "Kein Schöner Land in dieser Zeit",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296350626140241/Anton_Wilhelm_von_Zuccalmaglio_-_Kein_schoner_Land_in_dieser_Zeit.mp3"
                },
                {
                  "name": "Die Gedanken sind frei",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296366619009094/August_Hoffmann_von_Fallersleben_-_Die_Gedanken_sind_frei.mp3"
                },
                {
                  "name": "Loreley (Ich weiß nicht, was soll es bedeuten)",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296500606046349/Heinrich_Heine__Friedrich_Silcher_-_Loreley_Ich_wei_nicht_was_soll_es_bedeuten.mp3"
                },
                {
                  "name": "Du, Du liegst mir im Herzen",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296591505002516/Marlene_Dietrich-_Du_Du_Liegst_Mir_Im_Herzen.mp3"
                },
                {
                  "name": "Wenn die bunten Fahnen wehen",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296329440702575/Alf_Zschiesche_-_Wenn_die_bunten_Fahnen_wehen.mp3"
                }
            ]
                },
                4: {
              name: "Deutsche Protestlieder (Greens)",
              tracklist: [
                {
                  "name": "Gänsehaut - Karl der Käfer",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296471967338617/Gansehaut_-_Karl_der_Kafer.mp3"
                },
                {
                  "name": "Ton Steine Scherben – Keine Macht für niemand",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296741602377738/Ton_Steine_Scherben_-_Keine_Macht_fur_niemand.mp3"
                },
                {
                  "name": "Bots - Aufstehen",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296393466761226/Bots_-_Aufstehen.mp3"
                },
                {
                  "name": "Fehlfarben - Ein Jahr (Es geht voran)",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296445107011694/Fehlfarben_-_Ein_Jahr_Es_geht_voran.mp3"
                },
                {
                  "name": "Teller Bunte Knete - Stadtmensch",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296715027251270/Teller_Bunte_Knete_-_Stadtmensch.mp3"
                }
            ]
                },
                5: {
              name: "Deutsche Arbeiterlieder (SPD)",
              tracklist: [
                {
                  "name": "Die Internationale",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296479164780654/Hannes_Wader_-_Die_Internationale.mp3"
                },
                {
                  "name": "Wann wir schreiten Seit an Seit",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296517479747776/Hermann_Claudius__Michael_Englert_-_Wann_wir_schreiten_Seit_an_Seit.mp3"
                },
                {
                  "name": "Brüder, zur Sonne, zur Freiheit",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296430389211166/Ernst_Busch_-_Bruder_zur_Sonne_zur_Freiheit.mp3"
                },
                {
                  "name": "Auferstanden aus Ruinen (DDR Anthem)",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296491626045440/Hanns_Eisler__Johannes_Becher_-_Auferstanden_auf_Ruinen_DDR_Anthem.mp3"
                },
                {
                  "name": "Das Arbeitsfrontlied",
                  "url": "https://cdn.discordapp.com/attachments/1131296206908301423/1131296484445396992/Hannes_Wader_-_Einheitsfrontlied.mp3"
                }
            ]
                }
        }
        newMusicPlayer()
      }

          function shuffle(array) {
            let currentIndex = array.length, temporaryValue, randomIndex;

            while (0 !== currentIndex) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }


    function updateHeader() {
      var gameHeader = document.getElementsByClassName("game_header")[0];

      if (gameHeader.getAttribute("id") !== "modifiedHeader") {
        gameHeader.innerHTML = corrr;
        gameHeader.style.backgroundColor = nct_stuff.themes[nct_stuff.selectedTheme].coloring_title;
        gameHeader.setAttribute("id", "modifiedHeader");
        gameHeader.style.height="6.5em";
      }
    }

    var headerobserver = new MutationObserver(updateHeader);
    headerobserver.observe(document.documentElement, { childList: true, subtree: true });

    function updateCandidateForm() {

      const heading = document.querySelector("#candidate_form form h3");

      if (heading) {
        heading.textContent = "Please select your party:";
      }
     }

    function updateRunningMateForm() {

      const heading = document.querySelector("#running_mate_form form h3");

      if (heading) {
        heading.textContent = "Please select your candidate:";
      }
    }

    function removeCandidateSummary() {
        const candidateSummary = document.querySelector("#candidate_summary");
        if (candidateSummary) {
            const ulList = candidateSummary.querySelectorAll("ul:not(.my-ul)");
            ulList.forEach(ul => candidateSummary.removeChild(ul));
        }
    }

    function modifyAllocationForm() {

        const form = document.querySelector('form[name="game_type_selection"]');
            if(form){
            const select = form.querySelector('select[name="game_type_id"]');

            // change option value
            const option = select.querySelector('option[value="1"]');
            option.textContent = 'Proportional (Bundestag)';


            var optionToRemove = document.querySelector('option[value="2"]');
            if (optionToRemove) {
              optionToRemove.style.display = 'none';
            }

            // change h3 text
            const h3 = form.querySelector('h3');
            h3.textContent = 'How would you like the seats to be allocated';
            }
   }

function changeOpponentSelectionDescription() {
    const opponentSelectionDescription = document.getElementById("opponent_selection_description_window");

    if (!opponentSelectionDescription) return;

    // Check if the divs already exist, and if they do, stop the function
    if (document.getElementById("div1") || document.getElementById("div2")) return;

    // Clear the original content
    opponentSelectionDescription.innerHTML = '';

    // Define the texts and button labels
    const text1 = `<p><strong>Use the allocation method for the German Bundestag.</strong></p><p>The German electoral system is quite complex. Every voter has two votes, one for a party and one for a directly elected candidate in their constituency. Theoretically, half the parliament is determined first past the post by these direct elections and half proportionally through the party votes, with seats allocated with the Sainte-Laguë method on a per-state basis.<br> However, if a party receives more seats through this system than it would if the parliament was elected by strictly proportional votes, they get extra (overhanging) mandates and all over parties get compensatory mandates. Overall, all but three overhanging mandates get compensated. <br> To enter parliament, a party either needs 5% of the proportional vote or win in at least three districts. <br> For the purpose of this game, the system has been simplified. Only the proportional vote has been simulated - though there are some heuristics to guess the number of constituencies won by parties where this is relevant.`;

     const text2 = `<p><strong>Difficulty Options</strong></p><p>This mod has three different difficulty options. "Campaign Difficulty" is the normal difficulty option found in almost every TCT mod and influences how strong your party is in the polls. <br> "Coalition Difficulty" determines how hard the coalition talks after the election are. On "Guaranteed", any coalition you tick will happen, regardless of the result. On other difficulties, the probability for a coalition to be selected depends on several factors, like the election winner, the winning margin and your decisions during the campaign. Some coalitions are also inherently more likely than others.<br> State visits are disabled by default since only the popular vote matters and it would be best to always visit the most populous state. However, if desired, they can be turned back on. This also makes the game slightly easier. <br>Finally, the tooltip option will enable tooltips for a few phrases that give you additional explanations. It can be helpful for players unfamiliar with German politics.`;
    const btnText1 = 'Difficulty Options';
    const btnText2 = 'Electoral System';

    // Create the first div with the first text and the toggle button
    const div1 = document.createElement('div');
    div1.id = "div1";
    div1.innerHTML = `<p>${text1}</p><button id="toggleBtn">${btnText1}</button>`;

    // Create the second div with the second text, initially hidden
    const div2 = document.createElement('div');
    div2.id = "div2";
    div2.style.display = 'none';
    div2.innerHTML = `<p>${text2}</p><button id="toggleBtn2">${btnText2}</button>`;

    // Append both divs to the original element
    opponentSelectionDescription.appendChild(div1);
    opponentSelectionDescription.appendChild(div2);

    // Get the buttons
    const button1 = document.getElementById("toggleBtn");
    const button2 = document.getElementById("toggleBtn2");

    // Add event listeners to the buttons to toggle visibility of the divs
    button1.addEventListener("click", function() {
        div1.style.display = 'none';
        div2.style.display = 'block';
    });

    button2.addEventListener("click", function() {
        div2.style.display = 'none';
        div1.style.display = 'block';
    });
}




  function addCoalitionDifficultyDropdown() {
        var difficultyDiv = document.getElementById("difficulty_level");
        if (difficultyDiv && !document.getElementById("coalitionDifficultyDropdown")) {
            var difficulties = ["Guaranteed", "Very Easy", "Easy", "Normal", "Hard", "Impossible"];
            var difficultyValues = [1000000, 5, 1.5, 1, 0.75, 0.2];
            var dropdown = document.createElement("select");
            dropdown.id = "coalitionDifficultyDropdown";

            for (var i = 0; i < difficulties.length; i++) {
                var opt = document.createElement("option");
                opt.text = difficulties[i];
                if (difficulties[i] === "Normal") {
                    opt.selected = true;
                }
                opt.value = difficultyValues[i];
                dropdown.options.add(opt);
            }

            var form = document.createElement("form");
            form.name = "coalition_difficulty_level_selection";
            var header = document.createElement("h3");
            header.textContent = "Select coalition difficulty:";
            form.appendChild(header);
            form.appendChild(dropdown);
            difficultyDiv.appendChild(form);

            var visitsForm = document.createElement("form");
            visitsForm.name = "state_visits_selection";
            var visitsHeader = document.createElement("h3");
            visitsHeader.textContent = "Enable state visits";
            visitsForm.appendChild(visitsHeader);
            var visitsCheckbox = document.createElement("input");
            visitsCheckbox.type = "checkbox";
            visitsCheckbox.id = "stateVisitsCheckbox";
            visitsCheckbox.checked = false;
            visitsForm.appendChild(visitsCheckbox);
            difficultyDiv.appendChild(visitsForm);

            visitsCheckbox.addEventListener("change", function() {
                campaignTrail_temp.election_json[0].fields.has_visits = this.checked ? 1 : 0;
            });

             // Add tooltip checkbox here
            var tooltipForm = document.createElement("form");
            tooltipForm.name = "tooltip_selection";
            var tooltipHeader = document.createElement("h3");
            tooltipHeader.textContent = "Enable tooltips";
            tooltipForm.appendChild(tooltipHeader);
            var tooltipCheckbox = document.createElement("input");
            tooltipCheckbox.type = "checkbox";
            tooltipCheckbox.id = "tooltipCheckbox";
            tooltipCheckbox.checked = true;
            tooltipForm.appendChild(tooltipCheckbox);
            difficultyDiv.appendChild(tooltipForm);

            tooltipCheckbox.addEventListener("change", function() {
                e.displayTooltips = this.checked;
            });


            var difficultyForm = document.querySelector('form[name="difficulty_level_selection"]');
            var difficultyHeader = difficultyForm.querySelector('h3');
            difficultyHeader.textContent = "Select campaign difficulty:";

            var forms = document.querySelectorAll("#difficulty_level form");
            for (var i = 0; i < forms.length; i++) {
              forms[i].style.display = "inline-block";
              forms[i].style.paddingLeft = "10px"; // adjust the value as needed
              forms[i].style.paddingRight = "10px"; // adjust the value as needed
            }

            dropdown.addEventListener("change", function() {
                campaignTrail_temp.coalitionDifficulty = this.value;
            });
        }
    }

    function walkAndReplace(node, wordsToFind) {
        if (node.nodeType === Node.TEXT_NODE) {
            // Ignore nodes that are already wrapped with our span
            if (node.parentNode.nodeName.toLowerCase() === "span" && node.parentNode.style.color === 'white') {
                return;
            }

            let matched = false;
            let newNodeValue = node.nodeValue;

            for(let word of wordsToFind) {
                let searchRegEx = new RegExp(word, 'g');
                if (searchRegEx.test(newNodeValue)) {
                    matched = true;
                    newNodeValue = newNodeValue.replace(searchRegEx, `<span style="color: white;">${word}</span>`);
                }
            }

            if (matched) {
                let div = document.createElement('div');
                div.innerHTML = newNodeValue;
                let parent = node.parentNode;
                while (div.firstChild) {
                    parent.insertBefore(div.firstChild, node);
                }
                parent.removeChild(node);
            }

        } else {
            for(let i = 0; i < node.childNodes.length; i++) {
                walkAndReplace(node.childNodes[i], wordsToFind);
            }
        }
    }

    const myTableHTML = `
        <table> <tbody> <tr> <th>Party</th> <th>Seats</th> <th>Popular Votes</th> <th>Popular Vote %</th> </tr>            <tr><td style="text-align: left;">            <span style="background-color: #D61A29; color: #D61A29;">----</span>  SPD</td><td> 206 </td><td> 11,955,434 </td><td> 25.7% </td></tr>            <tr><td style="text-align: left;">            <span style="background-color: #28282B; color: #28282B;">----</span>  CDU/CSU</td><td> 197 </td><td> 11,178,298 </td><td> 24.1% </td></tr>            <tr><td style="text-align: left;">            <span style="background-color: #13A12D; color: #13A12D;">----</span>  Green Party</td><td> 118 </td><td> 6,852,206 </td><td> 14.8% </td></tr>            <tr><td style="text-align: left;">            <span style="background-color: #F5F518; color: #F5F518;">----</span>  FDP</td><td> 92 </td><td> 5,319,952 </td><td> 11.5% </td></tr>            <tr><td style="text-align: left;">            <span style="background-color: #2B8FE0; color: #2B8FE0;">----</span>  AfD</td><td> 83 </td><td> 4,803,902 </td><td> 10.3% </td></tr>            <tr><td style="text-align: left;">            <span style="background-color: #C910BA; color: #C910BA;">----</span>  The Left</td><td> 39 </td><td> 2,270,906 </td><td> 4.9% </td></tr>            <tr><td style="text-align: left;">            <span style="background-color: #807E7F; color: #807E7F;">----</span>  Others</td><td> 1 </td><td> 4,061,325 </td><td> 8.7% </td></tr></tbody></table>
    `;

        function resultReplacer() {
        const allTables = document.querySelectorAll('table');

        const targetTable = Array.from(allTables).find(table => {
            // Ensure table has at least 2 rows and the second row has at least one cell
            if (table.rows.length > 1 && table.rows[1].cells.length > 0) {
                // Get the first cell of the second row
                const firstColumnSecondRow = table.rows[1].cells[0];

                // Check if the cell's HTML contains '</span>'
                if (firstColumnSecondRow.innerHTML.includes('</span>')) {
                    // Split the cell's HTML by '</span>'
                    const splitHTML = firstColumnSecondRow.innerHTML.split('</span>');

                    // Get the text after '</span>', if any
                    const textAfterSpan = splitHTML.length > 1 ? splitHTML[1].trim() : '';

                    // Check if the text after '</span>' is 'Replace Me'
                    if (textAfterSpan === 'Replace Me') {
                        return true;
                    }
                }
            }
            return false;
        });

        if (targetTable) {
            targetTable.outerHTML = myTableHTML;
        }
    }

        function replaceWithTooltip(node, searchString, explanationText) {
            if (node.nodeType === Node.TEXT_NODE) {
                let parent = node.parentNode;
                while (parent) {
                    if (parent.className === "tooltip") {
                        return;
                    }
                    parent = parent.parentNode;
                }

                let regex = new RegExp(`\\b${searchString}\\b`, 'g');
                if (regex.test(node.nodeValue)) {
                    let fragments = node.nodeValue.split(regex);
                    parent = node.parentNode;

                    parent.removeChild(node);

                    fragments.forEach((fragment, index) => {
                        parent.appendChild(document.createTextNode(fragment));

                        // Don't append tooltip after the last fragment
                        if (index < fragments.length - 1) {
                            let tooltipSpan = document.createElement('span');
                            tooltipSpan.className = 'tooltip';
                            tooltipSpan.textContent = searchString;

                            let tooltipTextSpan = document.createElement('span');
                            tooltipTextSpan.className = 'tooltiptext';
                            tooltipTextSpan.innerHTML = explanationText;

                            tooltipSpan.appendChild(tooltipTextSpan);
                            parent.appendChild(tooltipSpan);
                        }
                    });
                }
            } else {
                for(let i = 0; i < node.childNodes.length; i++) {
                    replaceWithTooltip(node.childNodes[i], searchString, explanationText);
                }
            }
        }



    let changesInProgress = false;

    // Define the MutationObserver
    let masterObserver = new MutationObserver(masterFunction);


    // Master function
    function masterFunction() {
        if (changesInProgress) return;
        changesInProgress = true;
        masterObserver.disconnect();

        // Call all the functions here
        updateCandidateForm();
        updateRunningMateForm();
        removeCandidateSummary();
        modifyAllocationForm();
        changeOpponentSelectionDescription();
        applyColorStyles();
        addCoalitionDifficultyDropdown();
        resultReplacer();
        if(e.displayTooltips){
            replaceWithTooltip(document.body, "NRW", "North Rhine-Westphalia");
            replaceWithTooltip(document.body, "Soli", "Solidaritätszuschlag. An extra tax levelled since 1995 to help East Germany");

            //parsed tooltips
            replaceWithTooltip(document.body, "Nord-Stream 2", "Planned natural gas pipeline from Russia to Germany, through the Baltic Sea.");
            replaceWithTooltip(document.body, "Cum-Ex", "Stock-trading scheme, the goal of which is to get several refunds from capital gains taxes that were paid just once. A prominent case is the Hamburg-based Warburg-Bank, who defrauded the state while Olaf Scholz was Mayor.");
            replaceWithTooltip(document.body, "Wirecard", "Financial company, who ran a bank until 2020, when they shut down due to several billion Euros missing. The regulatory organization under Minister of Finances Olaf Scholz was heavily criticized for its lack of action.");
            replaceWithTooltip(document.body, "Riester-System", "State-encouraged private pension system named after former Minister of Labour, Walter Riester (SPD, 1998-2002), aimed at low-income workers who may get tax refunds on privately saved up money.");
            replaceWithTooltip(document.body, "Black Zero", "“Schwarze Null” in German; economic principle that forbids new debts while promising a balanced budget.");
            replaceWithTooltip(document.body, "Der Spiegel", "Famous German news magazine, known for its investigative journalism, breaking several scandals since 1947. Tends to be center left-liberal.");
            replaceWithTooltip(document.body, "Fukushima", "In 2011, a disaster took place at the nuclear reactor in Fukushima, Japan. Resulted in the first Green surge, and Merkel changing course on Nuclear Energy and resuming the phase-out, which started under the preceding Red-Green coalition.");
            replaceWithTooltip(document.body, "Frontex", "The European Agency for Border- and coastal protection of the Schengen Area (internally, the EU does not have border patrols).");
            replaceWithTooltip(document.body, "Environmental Protection Act", "“Klimaschutzgesetz” in German. Originally enacted by the Grand Coalition in 2019, it promises to uphold the goals by the Paris Conference and lays down concrete goals for CO²-emissions until 2030.");
            replaceWithTooltip(document.body, "Prioritization system", "When covid vaccines were sparse, certain groups had a prerogative, among them people above 60, with certain pre-existing conditions or with a high risk of infection due to their profession.");
            replaceWithTooltip(document.body, "Bundeswehr", "Name for the German armed forces and their civilian organizations.");
            replaceWithTooltip(document.body, "Social Market Economy", "Germany’s traditional economic system; consisting of a free market economy with a welfare state. Originally envisioned by Minister of the Economy Ludwig Erhard (CDU, 1949-1963).");
            replaceWithTooltip(document.body, "Landesvater", "“State-Father”. Traditionally a feudal lord, today jokingly used for a Head of Government in a state, usually an older male, serving as a trustworthy icon of a statesman.");
            replaceWithTooltip(document.body, "Rotkäppchen", "Famous East German brand of sparkling wine, from Freyburg/Unstrut, since 1894.");
            replaceWithTooltip(document.body, "Baumkuchen", "“Tree Cake”. Spit cake, baked over an open flame, with a layered dough, like the rings of a tree. Also quite popular in Japan.");
            replaceWithTooltip(document.body, "Eigenheim", "“Own-Home”. A small detached home, owned by a family. The dream of many Germans.");
            replaceWithTooltip(document.body, "Berghain", "Infamous techno club in Berlin. What happens in the Berghain, stays in the Berghain.");
            replaceWithTooltip(document.body, "Rubber Boots", "In 2002, SPD chancellor Schröder allegedly won reelection due to media coverage of him strutting about in rubber boots during the flooding of the river Elbe.");
            replaceWithTooltip(document.body, "Laschets Lacher", "<img src=”https://media.discordapp.net/attachments/1131296206908301423/1135571560950935702/kritik-an-laschet-wegen-lacher-im-flutgebiet-image.jpg.webp”>");
            replaceWithTooltip(document.body, "GroKo", "Abbr.“Große Koalition” - “Grand coalition”; consisting of Germany’s traditional two major parties, the SPD and the CDU/CSU. Has governed from 1966-1969, 2005-2009 and 2013-2021.");
            replaceWithTooltip(document.body, "Querdenker", "“Skewed Thinker” or “Across Thinker”; German word for someone who thinks outside the norm. Popularized by its usage on Covid skeptics during the pandemic.");
            replaceWithTooltip(document.body, "Bubatz", "<img src=”https://media.discordapp.net/attachments/1131296206908301423/1135575649814327307/c80463b818429cf523e9f4527d901ae1.jpg”>");
            replaceWithTooltip(document.body, "Die Bild", "Famous German boulevard newspaper. Quite popular, although widely mocked for its low journalistic standards. Punk Band <i>Die Ärzte</i> succinctly summed them up as “fear, hate, tits and the weather report”.");
            replaceWithTooltip(document.body, "Oktoberfest", "Traditional Bavarian folk festival. Internationally known for its served big mugs of beer (“Maß”) and the display of traditional Bavarian clothing (“Tracht”). Often incorrectly assumed to be a general German tradition.");
            replaceWithTooltip(document.body, "Heute-Show", "Popular German satire show on the public TV station ZDF, moderated by Oliver Welke. The German adaptation of The Daily Show.");
            replaceWithTooltip(document.body, "Vendetta", "Friedrich Merz was party group leader from 2000-2002 - until CDU chair Angela Merkel and CSU chair Edmund Stoiber made a deal, that the latter was to become chancellor candidate, the former new party group leader. Merz wasn’t consulted, and relegated to irrelevancy.");
            replaceWithTooltip(document.body, "Beleidigte Leberwurst", "“offended liver sausage” - German word for someone who is childishly sulking.");
            replaceWithTooltip(document.body, "Maut", "Old German word for a road toll. The CSU sought to establish tolls for private vehicles in 2015, but the European courts disallowed this in 2019, citing discrimination against foreign vehicle owners.");
            replaceWithTooltip(document.body, "Genosse Olaf", "<img src=https://media.discordapp.net/attachments/1131296206908301423/1135578447561904179/Olaf_Scholz_1984.jpg?width=1136&height=757>");
            replaceWithTooltip(document.body, "Terror-Shrek", "<img src=https://media.discordapp.net/attachments/1131296206908301423/1135578677632045056/3-formatOriginal.jpg?width=1136&height=758> That’s not even half of it. The guy has made several eccentric costumes - look up “Markus Söder Homer Simpson”.");
            replaceWithTooltip(document.body, "2015", "In 2015, about 2 million people sought refuge in Europe, coming from the Mediterranean Sea and the Balkans. A great amount had been held up in Hungary, until Merkel unilaterally decided to let them come to Germany. About 400k Syrians fled to Germany during this time.");
            replaceWithTooltip(document.body, "JU", "“Junge Union”, “Young Union”. The youth organization of the CDU/CSU. Usually considered quite unadventurous.");
            replaceWithTooltip(document.body, "Jusos", "“JungsozialistInnen”, “Young Socialists”. The youth organization of the SPD. Noticeably more left-wing than the national party. Has gained in influence over the last few years.");
            replaceWithTooltip(document.body, "Bridge-lockdown", "Proposal by Armin Laschet. The goal is to generally open up, but to have a short term, harsh lockdown in April, to bridge the time until more people are vaccinated and more tests are available.");
            replaceWithTooltip(document.body, "3rd CSU candidate", "The CSU has put up only two chancellor candidates for the Union: Franz-Josef Strauß in 1980 and Edmund Stoiber in 2002. Both lost against SPD incumbents.");
            replaceWithTooltip(document.body, "Annegret-Kramp-Karrenbauer", "The CDU Saarland party chair 2011-2019, and for a short while in 2018 General Secretary of the CDU, she was indirectly chosen by Merkel as her successor as party leader. After her tenure was heavily criticized, she got the Ministry of Defense (2019-2021) and retired shortly after.");
            replaceWithTooltip(document.body, "Norbert Röttgen", "Once a prominent CDU politician and Minister of the Environment (2009-2012): humiliatingly fired after his defeat as the CDU candidate for the North Rhine-Westphalian elections. In 2020 he tried for a comeback, but ended up as a third wheel behind Laschet and Merz.");
            replaceWithTooltip(document.body, "Konrad Adenauer", "First chancellor of West Germany (1949-1963). Started his career in Weimar Germany and was imprisoned during the Nazi era. He helped found the CDU, was responsible for the  and remains a great icon for German conservatives and the nation as a whole.");

        }
        replaceWithTooltip(document.body, "tooltip option", "Look out for words with a light blue background like this and hover them for a tooltip.");

        // Re-observe the document
        changesInProgress = false;
        masterObserver.observe(document.body, { childList: true, subtree: true });
    }

    // Start observing the document with the master observer
    masterObserver.observe(document.body, { childList: true, subtree: true });

    // Ensure we don't re-enter applyColorStyles
    function applyColorStyles() {
        let wordsToFind = ['Enable state visits?', 'Select coalition difficulty:', 'Please select the election you will run in:', 'This scenario was made by u/Vilvilea.', 'Please select your party:', 'Please select your candidate:', 'How would you like the seats to be allocated?', 'Select campaign difficulty:', 'Enable tooltips?'];

        walkAndReplace(document.body, wordsToFind);
    }

    const bodyElement = document.body;
    bodyElement.style.backgroundAttachment = 'fixed';


    async function appendStyle() {
        var metaTag=document.createElement('meta');
        metaTag.name = "viewport";
        metaTag.content = "width=device-width, initial-scale=1";
        document.getElementsByTagName('head')[0].appendChild(metaTag);

        if (!document.querySelector('#radio-option-style')) {
            let style = document.createElement('style');
            style.type = 'text/css';
            style.id = 'radio-option-style';
            style.innerHTML = `
            .inner_inner_window {
              display: flex;
              flex-direction: column;
            }
              #question_form {
              flex: 1;
              box-sizing: border-box;
            }
            form[name="question"] {
              display: flex;
              flex-direction: column;
              justify-content: space-between;
              height: 100%;
              box-sizing: border-box;
            }

            .radio-option {
                border: 2px solid #000000;
                background-color: #f2f2f2;
                border-radius: 10px;
                padding: 5px;
                margin-bottom: 5px;
                transition: background-color 0.1s ease;
            }

            .radio-option:hover {
                background-color: #e0e0e0; /* or any other color that is slightly different than #f2f2f2 */
            }

            .radio-option:hover label {
                font-size: .92em;
                font-weight: 700;
                margin-bottom: .1em;
            }

            .radio-option label {
              pointer-events: none;
            }

            .radio-option label .tooltip {
              pointer-events: auto;
            }

            /* Remove the default appearance of the radio button */
            input[type="radio"] {
              appearance: none;
              -webkit-appearance: none;
              -moz-appearance: none;
            }

            /* Create a custom radio button */
            input[type="radio"] {
              position: relative;
              display: inline-block;
              width: 16px; /* reduce width */
              height: 16px; /* reduce height */
              border: 2px solid black;
              border-radius: 4px; /* add border radius */
            }

            /* Create the cross icon (hidden when not checked) */
            input[type="radio"]:after {
              content: "";
              position: absolute;
              display: none;
            }

            /* Show the cross icon when checked */
            input[type="radio"]:checked:after {
              display: block;
            }

            input[type="radio"]:checked:after {
                content: "";
                display: inline-block;
                background-image: url("https://cdn.discordapp.com/attachments/1109846390575730788/1130851559371198544/Red-x-mark-transparent-background-1-Transparent-Images.png");
                background-repeat: no-repeat;
                background-size: contain; /* Or use a specific size like '10px 10px' */
                width: 20px;
                height: 20px;
                position: absolute; /* This takes the pseudo-element out of the document flow */
                left: -1px;
                top: -2px;
                z-index: 1;
            }

            .rounded-box {
                display: flex;
                flex-direction: column;
                justify-content: center;
                border: 4px solid black;
                margin: 10px;
                background-color: white;
                border-radius: 10px;
                overflow: hidden;
            }


             #candidate_pic,
            #running_mate_pic,
            .inner_window_sign_display {
                height: 14em;
            }
            #candidate_pic {
                margin-left: 12em;
            }
            .inner_window_sign_display {
                width: 27%;
            }
            .inner_window_question {
                height: auto;
            }
            #visit_window {
                height: auto;
            }
            #visit_content {
                height: 79%;
            }
            #state_info {
              height: 125%
            }
            #map_container {
              height: 30.78em
            }
            .description_window_small{
                height: 50%;
            }
           .campaign_trail_start_emphasis {
                background-color: #5f9aed;
            }

            #overall_details_container{
                    height: 98%;
                    overflow: auto;
                }

            #overall_result,
            #election_summary,
            #candidate_summary,
            #running_mate_summary,
            #opponent_selection_description_window{
                overflow: auto;
            }


        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background-color: lightblue;
            z-index: 98;
        }

        .tooltip .tooltiptext {
            width: 240px;  /* Adjust as needed */
            background-color: #b0b0b0;
            color: black;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 99;
            bottom: 20%;
            left: 20%;
            margin-left: -90px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid black;
            pointer-events: none;
            font-size:13px !important;
            line-height:1.5em !important;
            font-weight:normal !important;
            font-style: normal !important;
        }

        .tooltip:hover .tooltiptext {
            opacity: 1;
            transition-delay: 0.5s;
        }

            @media only screen and (max-width: 768px) {
                 .inner_window_question,
                 #results_container,
                 #map_footer,
                  #overall_details_container,
                  #main_content_area_reading,
                  #inner_window_2,
                  #inner_window_3,
                   #inner_window_4{
                    font-size: 1.8em;
                }
                #inner_window_2 select,
                    #inner_window_3 select,
                    #inner_window_4 select {
                        font-size: 1em;
                        padding: 10px;
                    }

                    #inner_window_2 button,
                    #inner_window_3 button,
                    #inner_window_4 button {
                        font-size: 1em;
                        line-height: 2em;
                    }

                 #inner_window_2,
                 #inner_window_3,
                 #inner_window_4{
                    overflow:auto;
                }
                #opponent_selection_description_window,
                #election_year_form,
                #candidate_description_window,
                #running_mate_description_window,
                #opponent_selection_description_window{
                height: auto;
                overflow: visible;
            }
                 #title_container{
                   font-size:1.2em
                }
                #visit_window {
                    font-size: 1.8em;
                    width: 90%;
                    left:5%;
                }
                  .mobile-hide {
                    display: none;
                  }
                 .inner_window_question button,
                    #visit_window button,
                     #map_footer{
                        line-height: 2.5em;
                    }
                 #drop_down_area_state {
                    margin-left: auto;
                    margin-right: auto;
                  }
            }
            `;

            document.head.appendChild(style);
        }
    }
    appendStyle();

    var invisibleElement = document.createElement('div');
    invisibleElement.style.display = 'none';
    invisibleElement.id = 'my-invisible-element';
    document.body.appendChild(invisibleElement);
}